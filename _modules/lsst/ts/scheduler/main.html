

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>lsst.ts.scheduler.main &mdash; LSST Scheduler unknown documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../search.html"/>
    <link rel="top" title="LSST Scheduler unknown documentation" href="../../../../index.html"/>
        <link rel="up" title="Module code" href="../../../index.html"/> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../index.html" class="icon icon-home"> LSST Scheduler
          

          
          </a>

          
            
            
              <div class="version">
                unknown
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../scheduler.html">LSST Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../driver.html">Driver API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../history.html">History</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/lsst.ts.scheduler.html">lsst.ts.scheduler package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">LSST Scheduler</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>lsst.ts.scheduler.main</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for lsst.ts.scheduler.main</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">builtins</span> <span class="k">import</span> <span class="nb">object</span>
<span class="kn">from</span> <span class="nn">builtins</span> <span class="k">import</span> <span class="nb">range</span>
<span class="kn">from</span> <span class="nn">builtins</span> <span class="k">import</span> <span class="nb">str</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">logging.handlers</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="kn">from</span> <span class="nn">SALPY_scheduler</span> <span class="k">import</span> <span class="n">SAL_scheduler</span>
<span class="kn">from</span> <span class="nn">SALPY_scheduler</span> <span class="k">import</span> <span class="n">scheduler_timeHandlerC</span>
<span class="kn">from</span> <span class="nn">SALPY_scheduler</span> <span class="k">import</span> <span class="n">scheduler_observatoryStateC</span>
<span class="kn">from</span> <span class="nn">SALPY_scheduler</span> <span class="k">import</span> <span class="n">scheduler_cloudC</span>
<span class="kn">from</span> <span class="nn">SALPY_scheduler</span> <span class="k">import</span> <span class="n">scheduler_seeingC</span>
<span class="kn">from</span> <span class="nn">SALPY_scheduler</span> <span class="k">import</span> <span class="n">scheduler_observationC</span>
<span class="kn">from</span> <span class="nn">SALPY_scheduler</span> <span class="k">import</span> <span class="n">scheduler_targetC</span>
<span class="kn">from</span> <span class="nn">SALPY_scheduler</span> <span class="k">import</span> <span class="n">scheduler_schedulerConfigC</span>
<span class="kn">from</span> <span class="nn">SALPY_scheduler</span> <span class="k">import</span> <span class="n">scheduler_driverConfigC</span>
<span class="kn">from</span> <span class="nn">SALPY_scheduler</span> <span class="k">import</span> <span class="n">scheduler_obsSiteConfigC</span>
<span class="kn">from</span> <span class="nn">SALPY_scheduler</span> <span class="k">import</span> <span class="n">scheduler_telescopeConfigC</span>
<span class="kn">from</span> <span class="nn">SALPY_scheduler</span> <span class="k">import</span> <span class="n">scheduler_domeConfigC</span>
<span class="kn">from</span> <span class="nn">SALPY_scheduler</span> <span class="k">import</span> <span class="n">scheduler_rotatorConfigC</span>
<span class="kn">from</span> <span class="nn">SALPY_scheduler</span> <span class="k">import</span> <span class="n">scheduler_cameraConfigC</span>
<span class="kn">from</span> <span class="nn">SALPY_scheduler</span> <span class="k">import</span> <span class="n">scheduler_slewConfigC</span>
<span class="kn">from</span> <span class="nn">SALPY_scheduler</span> <span class="k">import</span> <span class="n">scheduler_opticsLoopCorrConfigC</span>
<span class="kn">from</span> <span class="nn">SALPY_scheduler</span> <span class="k">import</span> <span class="n">scheduler_parkConfigC</span>
<span class="kn">from</span> <span class="nn">SALPY_scheduler</span> <span class="k">import</span> <span class="n">scheduler_generalPropConfigC</span>
<span class="kn">from</span> <span class="nn">SALPY_scheduler</span> <span class="k">import</span> <span class="n">scheduler_sequencePropConfigC</span>
<span class="kn">from</span> <span class="nn">SALPY_scheduler</span> <span class="k">import</span> <span class="n">scheduler_filterSwapC</span>
<span class="kn">from</span> <span class="nn">SALPY_scheduler</span> <span class="k">import</span> <span class="n">scheduler_interestedProposalC</span>

<span class="kn">from</span> <span class="nn">lsst.ts.dateloc</span> <span class="k">import</span> <span class="n">ObservatoryLocation</span>
<span class="kn">from</span> <span class="nn">lsst.ts.observatory.model</span> <span class="k">import</span> <span class="n">ObservatoryModel</span><span class="p">,</span> <span class="n">ObservatoryState</span>
<span class="kn">from</span> <span class="nn">lsst.ts.observatory.model</span> <span class="k">import</span> <span class="n">Target</span>
<span class="kn">from</span> <span class="nn">lsst.ts.scheduler.setup</span> <span class="k">import</span> <span class="n">TRACE</span><span class="p">,</span> <span class="n">EXTENSIVE</span>
<span class="kn">from</span> <span class="nn">lsst.ts.scheduler.kernel</span> <span class="k">import</span> <span class="n">read_conf_file</span><span class="p">,</span> <span class="n">conf_file_path</span>
<span class="kn">from</span> <span class="nn">lsst.ts.scheduler</span> <span class="k">import</span> <span class="n">Driver</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Main&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="Main"><a class="viewcode-back" href="../../../../api/lsst.ts.scheduler.html#lsst.ts.scheduler.main.Main">[docs]</a><span class="k">class</span> <span class="nc">Main</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;schedulerMain&quot;</span><span class="p">)</span>

        <span class="n">main_confdict</span> <span class="o">=</span> <span class="n">read_conf_file</span><span class="p">(</span><span class="n">conf_file_path</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="s2">&quot;conf&quot;</span><span class="p">,</span> <span class="s2">&quot;scheduler&quot;</span><span class="p">,</span> <span class="s2">&quot;main.conf&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measinterval</span> <span class="o">=</span> <span class="n">main_confdict</span><span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">][</span><span class="s1">&#39;rate_meas_interval&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sal</span> <span class="o">=</span> <span class="n">SAL_scheduler</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">setDebugLevel</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sal_sleeper</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_loop_timeouts</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">timeout</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">topic_schedulerConfig</span> <span class="o">=</span> <span class="n">scheduler_schedulerConfigC</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_driverConfig</span> <span class="o">=</span> <span class="n">scheduler_driverConfigC</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_obsSiteConfig</span> <span class="o">=</span> <span class="n">scheduler_obsSiteConfigC</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_telescopeConfig</span> <span class="o">=</span> <span class="n">scheduler_telescopeConfigC</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_domeConfig</span> <span class="o">=</span> <span class="n">scheduler_domeConfigC</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_rotatorConfig</span> <span class="o">=</span> <span class="n">scheduler_rotatorConfigC</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_cameraConfig</span> <span class="o">=</span> <span class="n">scheduler_cameraConfigC</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_slewConfig</span> <span class="o">=</span> <span class="n">scheduler_slewConfigC</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_opticsConfig</span> <span class="o">=</span> <span class="n">scheduler_opticsLoopCorrConfigC</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_parkConfig</span> <span class="o">=</span> <span class="n">scheduler_parkConfigC</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_areaDistPropConfig</span> <span class="o">=</span> <span class="n">scheduler_generalPropConfigC</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_sequencePropConfig</span> <span class="o">=</span> <span class="n">scheduler_sequencePropConfigC</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topicTime</span> <span class="o">=</span> <span class="n">scheduler_timeHandlerC</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topicObservatoryState</span> <span class="o">=</span> <span class="n">scheduler_observatoryStateC</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_cloud</span> <span class="o">=</span> <span class="n">scheduler_cloudC</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic_seeing</span> <span class="o">=</span> <span class="n">scheduler_seeingC</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topicObservation</span> <span class="o">=</span> <span class="n">scheduler_observationC</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topicTarget</span> <span class="o">=</span> <span class="n">scheduler_targetC</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topicFilterSwap</span> <span class="o">=</span> <span class="n">scheduler_filterSwapC</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tInterestedProposal</span> <span class="o">=</span> <span class="n">scheduler_interestedProposalC</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">schedulerDriver</span> <span class="o">=</span> <span class="n">Driver</span><span class="p">()</span>

<div class="viewcode-block" id="Main.sal_init"><a class="viewcode-back" href="../../../../api/lsst.ts.scheduler.html#lsst.ts.scheduler.main.Main.sal_init">[docs]</a>    <span class="k">def</span> <span class="nf">sal_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting pub/sub initialization&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">salTelemetrySub</span><span class="p">(</span><span class="s2">&quot;scheduler_schedulerConfig&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">salTelemetrySub</span><span class="p">(</span><span class="s2">&quot;scheduler_driverConfig&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">salTelemetrySub</span><span class="p">(</span><span class="s2">&quot;scheduler_obsSiteConfig&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">salTelemetrySub</span><span class="p">(</span><span class="s2">&quot;scheduler_telescopeConfig&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">salTelemetrySub</span><span class="p">(</span><span class="s2">&quot;scheduler_domeConfig&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">salTelemetrySub</span><span class="p">(</span><span class="s2">&quot;scheduler_rotatorConfig&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">salTelemetrySub</span><span class="p">(</span><span class="s2">&quot;scheduler_cameraConfig&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">salTelemetrySub</span><span class="p">(</span><span class="s2">&quot;scheduler_slewConfig&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">salTelemetrySub</span><span class="p">(</span><span class="s2">&quot;scheduler_opticsLoopCorrConfig&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">salTelemetrySub</span><span class="p">(</span><span class="s2">&quot;scheduler_parkConfig&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">salTelemetrySub</span><span class="p">(</span><span class="s2">&quot;scheduler_generalPropConfig&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">salTelemetrySub</span><span class="p">(</span><span class="s2">&quot;scheduler_sequencePropConfig&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">salTelemetrySub</span><span class="p">(</span><span class="s2">&quot;scheduler_timeHandler&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">salTelemetrySub</span><span class="p">(</span><span class="s2">&quot;scheduler_observatoryState&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">salTelemetrySub</span><span class="p">(</span><span class="s2">&quot;scheduler_cloud&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">salTelemetrySub</span><span class="p">(</span><span class="s2">&quot;scheduler_seeing&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">salTelemetrySub</span><span class="p">(</span><span class="s2">&quot;scheduler_observation&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">salTelemetryPub</span><span class="p">(</span><span class="s2">&quot;scheduler_target&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">salTelemetryPub</span><span class="p">(</span><span class="s2">&quot;scheduler_filterSwap&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">salTelemetryPub</span><span class="p">(</span><span class="s2">&quot;scheduler_interestedProposal&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finished pub/sub initialization&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Main.run"><a class="viewcode-back" href="../../../../api/lsst.ts.scheduler.html#lsst.ts.scheduler.main.Main.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run&quot;</span><span class="p">)</span>

        <span class="n">meascount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">visitcount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">synccount</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">meastime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="n">timestamp</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lastconfigtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">waitconfig</span><span class="p">:</span>
                <span class="n">scode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">getNextSample_schedulerConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_schedulerConfig</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">scode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_schedulerConfig</span><span class="o">.</span><span class="n">survey_duration</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">):</span>
                    <span class="n">lastconfigtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="n">survey_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_schedulerConfig</span><span class="o">.</span><span class="n">survey_duration</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: rx scheduler config survey_duration=</span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">survey_duration</span><span class="p">))</span>
                    <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">tf</span> <span class="o">-</span> <span class="n">lastconfigtime</span> <span class="o">&gt;</span> <span class="mf">20.0</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: scheduler config timeout&quot;</span><span class="p">)</span>
                        <span class="n">config_file</span> <span class="o">=</span> <span class="n">conf_file_path</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="s2">&quot;conf&quot;</span><span class="p">,</span> <span class="s2">&quot;survey&quot;</span><span class="p">,</span> <span class="s2">&quot;survey.conf&quot;</span><span class="p">)</span>
                        <span class="n">config_dict</span> <span class="o">=</span> <span class="n">read_conf_file</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
                        <span class="n">survey_duration</span> <span class="o">=</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;survey&quot;</span><span class="p">][</span><span class="s2">&quot;survey_duration&quot;</span><span class="p">]</span>
                        <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sal_sleeper</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schedulerDriver</span><span class="o">.</span><span class="n">configure_duration</span><span class="p">(</span><span class="n">survey_duration</span><span class="p">)</span>

            <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lastconfigtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">waitconfig</span><span class="p">:</span>
                <span class="n">scode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">getNextSample_driverConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_driverConfig</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">scode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_driverConfig</span><span class="o">.</span><span class="n">timecost_time_max</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">lastconfigtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="n">config_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rtopic_driver_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_driverConfig</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: rx driver config=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">config_dict</span><span class="p">))</span>
                    <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">tf</span> <span class="o">-</span> <span class="n">lastconfigtime</span> <span class="o">&gt;</span> <span class="mf">10.0</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: driver config timeout&quot;</span><span class="p">)</span>
                        <span class="n">config_file</span> <span class="o">=</span> <span class="n">conf_file_path</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="s2">&quot;conf&quot;</span><span class="p">,</span> <span class="s2">&quot;scheduler&quot;</span><span class="p">,</span> <span class="s2">&quot;driver.conf&quot;</span><span class="p">)</span>
                        <span class="n">config_dict</span> <span class="o">=</span> <span class="n">read_conf_file</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
                        <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sal_sleeper</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schedulerDriver</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">config_dict</span><span class="p">)</span>

            <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lastconfigtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">waitconfig</span><span class="p">:</span>
                <span class="n">scode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">getNextSample_obsSiteConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_obsSiteConfig</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">scode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_obsSiteConfig</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
                    <span class="n">lastconfigtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="n">config_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rtopic_location_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_obsSiteConfig</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: rx site config=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">config_dict</span><span class="p">))</span>
                    <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">tf</span> <span class="o">-</span> <span class="n">lastconfigtime</span> <span class="o">&gt;</span> <span class="mf">10.0</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: site config timeout&quot;</span><span class="p">)</span>
                        <span class="n">config_dict</span> <span class="o">=</span> <span class="n">ObservatoryLocation</span><span class="o">.</span><span class="n">get_configure_dict</span><span class="p">()</span>
                        <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sal_sleeper</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schedulerDriver</span><span class="o">.</span><span class="n">configure_location</span><span class="p">(</span><span class="n">config_dict</span><span class="p">)</span>

            <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lastconfigtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">waitconfig</span><span class="p">:</span>
                <span class="n">scode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">getNextSample_telescopeConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_telescopeConfig</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">scode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_telescopeConfig</span><span class="o">.</span><span class="n">altitude_minpos</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">lastconfigtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="n">config_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rtopic_telescope_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_telescopeConfig</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: rx telescope config=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">config_dict</span><span class="p">))</span>
                    <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">tf</span> <span class="o">-</span> <span class="n">lastconfigtime</span> <span class="o">&gt;</span> <span class="mf">10.0</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: telescope config timeout&quot;</span><span class="p">)</span>
                        <span class="n">config_dict</span> <span class="o">=</span> <span class="n">ObservatoryModel</span><span class="o">.</span><span class="n">get_configure_dict</span><span class="p">()</span>
                        <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sal_sleeper</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schedulerDriver</span><span class="o">.</span><span class="n">configure_telescope</span><span class="p">(</span><span class="n">config_dict</span><span class="p">)</span>

            <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lastconfigtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">waitconfig</span><span class="p">:</span>
                <span class="n">scode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">getNextSample_domeConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_domeConfig</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">scode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_domeConfig</span><span class="o">.</span><span class="n">altitude_maxspeed</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">lastconfigtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="n">config_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rtopic_dome_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_domeConfig</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: rx dome config=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">config_dict</span><span class="p">))</span>
                    <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">tf</span> <span class="o">-</span> <span class="n">lastconfigtime</span> <span class="o">&gt;</span> <span class="mf">10.0</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: dome config timeout&quot;</span><span class="p">)</span>
                        <span class="n">config_dict</span> <span class="o">=</span> <span class="n">ObservatoryModel</span><span class="o">.</span><span class="n">get_configure_dict</span><span class="p">()</span>
                        <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sal_sleeper</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schedulerDriver</span><span class="o">.</span><span class="n">configure_dome</span><span class="p">(</span><span class="n">config_dict</span><span class="p">)</span>

            <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lastconfigtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">waitconfig</span><span class="p">:</span>
                <span class="n">scode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">getNextSample_rotatorConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_rotatorConfig</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">scode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_rotatorConfig</span><span class="o">.</span><span class="n">maxspeed</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">lastconfigtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="n">config_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rtopic_rotator_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_rotatorConfig</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: rx rotator config=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">config_dict</span><span class="p">))</span>
                    <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">tf</span> <span class="o">-</span> <span class="n">lastconfigtime</span> <span class="o">&gt;</span> <span class="mf">10.0</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: rotator config timeout&quot;</span><span class="p">)</span>
                        <span class="n">config_dict</span> <span class="o">=</span> <span class="n">ObservatoryModel</span><span class="o">.</span><span class="n">get_configure_dict</span><span class="p">()</span>
                        <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sal_sleeper</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schedulerDriver</span><span class="o">.</span><span class="n">configure_rotator</span><span class="p">(</span><span class="n">config_dict</span><span class="p">)</span>

            <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lastconfigtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">waitconfig</span><span class="p">:</span>
                <span class="n">scode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">getNextSample_cameraConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_cameraConfig</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">scode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_cameraConfig</span><span class="o">.</span><span class="n">readout_time</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">lastconfigtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="n">config_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rtopic_camera_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_cameraConfig</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: rx camera config=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">config_dict</span><span class="p">))</span>
                    <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">tf</span> <span class="o">-</span> <span class="n">lastconfigtime</span> <span class="o">&gt;</span> <span class="mf">10.0</span><span class="p">):</span>
                        <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: camera config timeout&quot;</span><span class="p">)</span>
                        <span class="n">config_dict</span> <span class="o">=</span> <span class="n">ObservatoryModel</span><span class="o">.</span><span class="n">get_configure_dict</span><span class="p">()</span>
                        <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sal_sleeper</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schedulerDriver</span><span class="o">.</span><span class="n">configure_camera</span><span class="p">(</span><span class="n">config_dict</span><span class="p">)</span>

            <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lastconfigtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">waitconfig</span><span class="p">:</span>
                <span class="n">scode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">getNextSample_slewConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_slewConfig</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">scode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_slewConfig</span><span class="o">.</span><span class="n">prereq_exposures</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
                    <span class="n">lastconfigtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="n">config_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rtopic_slew_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_slewConfig</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: rx slew config=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">config_dict</span><span class="p">))</span>
                    <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">tf</span> <span class="o">-</span> <span class="n">lastconfigtime</span> <span class="o">&gt;</span> <span class="mf">10.0</span><span class="p">):</span>
                        <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: slew config timeout&quot;</span><span class="p">)</span>
                        <span class="n">config_dict</span> <span class="o">=</span> <span class="n">ObservatoryModel</span><span class="o">.</span><span class="n">get_configure_dict</span><span class="p">()</span>
                        <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sal_sleeper</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schedulerDriver</span><span class="o">.</span><span class="n">configure_slew</span><span class="p">(</span><span class="n">config_dict</span><span class="p">)</span>

            <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lastconfigtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">waitconfig</span><span class="p">:</span>
                <span class="n">scode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">getNextSample_opticsLoopCorrConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_opticsConfig</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">scode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_opticsConfig</span><span class="o">.</span><span class="n">tel_optics_ol_slope</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">lastconfigtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="n">config_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rtopic_optics_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_opticsConfig</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: rx optics config=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">config_dict</span><span class="p">))</span>
                    <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">tf</span> <span class="o">-</span> <span class="n">lastconfigtime</span> <span class="o">&gt;</span> <span class="mf">10.0</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: optics config timeout&quot;</span><span class="p">)</span>
                        <span class="n">config_dict</span> <span class="o">=</span> <span class="n">ObservatoryModel</span><span class="o">.</span><span class="n">get_configure_dict</span><span class="p">()</span>
                        <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sal_sleeper</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schedulerDriver</span><span class="o">.</span><span class="n">configure_optics</span><span class="p">(</span><span class="n">config_dict</span><span class="p">)</span>

            <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lastconfigtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">waitconfig</span><span class="p">:</span>
                <span class="n">scode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">getNextSample_parkConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_parkConfig</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">scode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_parkConfig</span><span class="o">.</span><span class="n">telescope_altitude</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">lastconfigtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="n">config_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rtopic_park_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_parkConfig</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: rx park config=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">config_dict</span><span class="p">))</span>
                    <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">tf</span> <span class="o">-</span> <span class="n">lastconfigtime</span> <span class="o">&gt;</span> <span class="mf">10.0</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: park config timeout&quot;</span><span class="p">)</span>
                        <span class="n">config_dict</span> <span class="o">=</span> <span class="n">ObservatoryModel</span><span class="o">.</span><span class="n">get_configure_dict</span><span class="p">()</span>
                        <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sal_sleeper</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schedulerDriver</span><span class="o">.</span><span class="n">configure_park</span><span class="p">(</span><span class="n">config_dict</span><span class="p">)</span>

            <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lastconfigtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">config_dict</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">good_config</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">while</span> <span class="n">waitconfig</span><span class="p">:</span>
                <span class="n">scode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">getNextSample_generalPropConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_areaDistPropConfig</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">scode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_areaDistPropConfig</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
                    <span class="n">lastconfigtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_areaDistPropConfig</span><span class="o">.</span><span class="n">name</span>
                    <span class="n">prop_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_areaDistPropConfig</span><span class="o">.</span><span class="n">prop_id</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">prop_id</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;NULL&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: area prop config null&quot;</span><span class="p">)</span>
                        <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">config_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rtopic_area_prop_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_areaDistPropConfig</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: rx area prop id=</span><span class="si">%i</span><span class="s2"> name=</span><span class="si">%s</span><span class="s2"> config=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prop_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
                                                                                     <span class="n">config_dict</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">schedulerDriver</span><span class="o">.</span><span class="n">create_area_proposal</span><span class="p">(</span><span class="n">prop_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">)</span>
                        <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">good_config</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">tf</span> <span class="o">-</span> <span class="n">lastconfigtime</span> <span class="o">&gt;</span> <span class="mf">10.0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: area prop config timeout&quot;</span><span class="p">)</span>
                        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                        if not good_config:</span>
<span class="sd">                            area_proposals = [&quot;north_ecliptic_spur.conf&quot;, &quot;south_celestial_pole.conf&quot;,</span>
<span class="sd">                                              &quot;wide_fast_deep.conf&quot;, &quot;galactic_plane.conf&quot;]</span>
<span class="sd">                            for prop_id, prop_config in enumerate(area_proposals):</span>
<span class="sd">                                config_file = conf_file_path(__name__, &quot;conf&quot;, &quot;survey&quot;, prop_config)</span>
<span class="sd">                                config_dict = read_conf_file(config_file)</span>
<span class="sd">                                name = &quot;&quot;.join([x.capitalize() for x in prop_config.split(&#39;.&#39;)[0].split(&#39;_&#39;)])</span>
<span class="sd">                                self.schedulerDriver.create_area_proposal(prop_id, name, config_dict)</span>
<span class="sd">                        &quot;&quot;&quot;</span>
                        <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sal_sleeper</span><span class="p">)</span>

            <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lastconfigtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">config_dict</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">good_config</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">while</span> <span class="n">waitconfig</span><span class="p">:</span>
                <span class="n">scode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">getNextSample_sequencePropConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_sequencePropConfig</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">scode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_sequencePropConfig</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
                    <span class="n">lastconfigtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_sequencePropConfig</span><span class="o">.</span><span class="n">name</span>
                    <span class="n">prop_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_sequencePropConfig</span><span class="o">.</span><span class="n">prop_id</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">prop_id</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;NULL&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: seq prop config null&quot;</span><span class="p">)</span>
                        <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">config_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rtopic_seq_prop_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_sequencePropConfig</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: rx seq prop id=</span><span class="si">%i</span><span class="s2"> name=</span><span class="si">%s</span><span class="s2"> config=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prop_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
                                                                                    <span class="n">config_dict</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">schedulerDriver</span><span class="o">.</span><span class="n">create_sequence_proposal</span><span class="p">(</span><span class="n">prop_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">)</span>
                        <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">good_config</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">tf</span> <span class="o">-</span> <span class="n">lastconfigtime</span> <span class="o">&gt;</span> <span class="mf">10.0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: seq prop config timeout&quot;</span><span class="p">)</span>
                        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                        if not good_config:</span>
<span class="sd">                            seq_proposals = [&quot;deep_drilling_cosmology1.conf&quot;]</span>
<span class="sd">                            for prop_id, prop_config in enumerate(seq_proposals):</span>
<span class="sd">                                config_file = conf_file_path(__name__, &quot;conf&quot;, &quot;survey&quot;, prop_config)</span>
<span class="sd">                                config_dict = read_conf_file(config_file)</span>
<span class="sd">                                name = &quot;&quot;.join([x.capitalize() for x in prop_config.split(&#39;.&#39;)[0].split(&#39;_&#39;)])</span>
<span class="sd">                                self.schedulerDriver.create_sequence_proposal(prop_id, name, config_dict)</span>
<span class="sd">                        &quot;&quot;&quot;</span>
                        <span class="n">waitconfig</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sal_sleeper</span><span class="p">)</span>

            <span class="n">waittime</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lasttimetime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">waittime</span><span class="p">:</span>
                <span class="n">scode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">getNextSample_timeHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topicTime</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">scode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">topicTime</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">lasttimetime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="n">nightstamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topicTime</span><span class="o">.</span><span class="n">night</span>
                    <span class="n">is_down</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topicTime</span><span class="o">.</span><span class="n">is_down</span>
                    <span class="n">down_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topicTime</span><span class="o">.</span><span class="n">down_duration</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">EXTENSIVE</span><span class="p">,</span> <span class="s2">&quot;run: rx time=</span><span class="si">%.6f</span><span class="s2"> night=</span><span class="si">%i</span><span class="s2"> is_down=</span><span class="si">%s</span><span class="s2"> down_duration=</span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topicTime</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">nightstamp</span><span class="p">,</span> <span class="n">is_down</span><span class="p">,</span> <span class="n">down_duration</span><span class="p">))</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topicTime</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">&gt;</span> <span class="n">timestamp</span><span class="p">:</span>
                        <span class="n">timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topicTime</span><span class="o">.</span><span class="n">timestamp</span>
                        <span class="n">isnight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedulerDriver</span><span class="o">.</span><span class="n">update_time</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">nightstamp</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">isnight</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">is_down</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: downtime duration=</span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">down_duration</span><span class="p">))</span>
                                <span class="n">waitstate</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">waitstate</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="p">(</span><span class="n">needswap</span><span class="p">,</span> <span class="n">filter2unmount</span><span class="p">,</span> <span class="n">filter2mount</span><span class="p">)</span> <span class="o">=</span> \
                                <span class="bp">self</span><span class="o">.</span><span class="n">schedulerDriver</span><span class="o">.</span><span class="n">get_need_filter_swap</span><span class="p">()</span>

                            <span class="bp">self</span><span class="o">.</span><span class="n">topicFilterSwap</span><span class="o">.</span><span class="n">need_swap</span> <span class="o">=</span> <span class="n">needswap</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">topicFilterSwap</span><span class="o">.</span><span class="n">filter_to_unmount</span> <span class="o">=</span> <span class="n">filter2unmount</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">putSample_filterSwap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topicFilterSwap</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: tx filter swap </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">needswap</span><span class="p">,</span> <span class="n">filter2unmount</span><span class="p">))</span>
                            <span class="n">waitstate</span> <span class="o">=</span> <span class="kc">False</span>

                        <span class="n">laststatetime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                        <span class="k">while</span> <span class="n">waitstate</span><span class="p">:</span>
                            <span class="n">scode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">getNextSample_observatoryState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topicObservatoryState</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">scode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">topicObservatoryState</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">laststatetime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                                <span class="n">waitstate</span> <span class="o">=</span> <span class="kc">False</span>
                                <span class="n">observatory_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rtopic_observatory_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topicObservatoryState</span><span class="p">)</span>

                                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">EXTENSIVE</span><span class="p">,</span> <span class="s2">&quot;run: rx state </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">observatory_state</span><span class="p">))</span>

                                <span class="bp">self</span><span class="o">.</span><span class="n">schedulerDriver</span><span class="o">.</span><span class="n">update_internal_conditions</span><span class="p">(</span><span class="n">observatory_state</span><span class="p">,</span> <span class="n">nightstamp</span><span class="p">)</span>

                                <span class="k">if</span> <span class="n">is_down</span><span class="p">:</span>
                                    <span class="n">waitobservation</span> <span class="o">=</span> <span class="kc">False</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">waitcloud</span> <span class="o">=</span> <span class="kc">True</span>
                                    <span class="n">lastcloudtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                                    <span class="k">while</span> <span class="n">waitcloud</span><span class="p">:</span>
                                        <span class="n">scode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">getNextSample_cloud</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_cloud</span><span class="p">)</span>
                                        <span class="k">if</span> <span class="n">scode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_cloud</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                                            <span class="n">lastcloudtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                                            <span class="n">waitcloud</span> <span class="o">=</span> <span class="kc">False</span>
                                            <span class="n">cloud</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_cloud</span><span class="o">.</span><span class="n">cloud</span>
                                        <span class="k">else</span><span class="p">:</span>
                                            <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                                            <span class="k">if</span> <span class="p">(</span><span class="n">tf</span> <span class="o">-</span> <span class="n">lastcloudtime</span> <span class="o">&gt;</span> <span class="mf">10.0</span><span class="p">):</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: cloud timeout&quot;</span><span class="p">)</span>
                                                <span class="n">waitcloud</span> <span class="o">=</span> <span class="kc">False</span>
                                                <span class="n">cloud</span> <span class="o">=</span> <span class="mf">0.0</span>

                                    <span class="n">waitseeing</span> <span class="o">=</span> <span class="kc">True</span>
                                    <span class="n">lastseeingtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                                    <span class="k">while</span> <span class="n">waitseeing</span><span class="p">:</span>
                                        <span class="n">scode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">getNextSample_seeing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic_seeing</span><span class="p">)</span>
                                        <span class="k">if</span> <span class="n">scode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_seeing</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                                            <span class="n">lastseeingtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                                            <span class="n">waitseeing</span> <span class="o">=</span> <span class="kc">False</span>
                                            <span class="n">seeing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic_seeing</span><span class="o">.</span><span class="n">seeing</span>
                                        <span class="k">else</span><span class="p">:</span>
                                            <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                                            <span class="k">if</span> <span class="p">(</span><span class="n">tf</span> <span class="o">-</span> <span class="n">lastseeingtime</span> <span class="o">&gt;</span> <span class="mf">10.0</span><span class="p">):</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: seeing timeout&quot;</span><span class="p">)</span>
                                                <span class="n">waitseeing</span> <span class="o">=</span> <span class="kc">False</span>
                                                <span class="n">seeing</span> <span class="o">=</span> <span class="mf">0.0</span>

                                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">EXTENSIVE</span><span class="p">,</span> <span class="s2">&quot;run: rx conditions cloud=</span><span class="si">%.2f</span><span class="s2"> seeing=</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                                                 <span class="p">(</span><span class="n">cloud</span><span class="p">,</span> <span class="n">seeing</span><span class="p">))</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">schedulerDriver</span><span class="o">.</span><span class="n">update_external_conditions</span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span> <span class="n">seeing</span><span class="p">)</span>

                                    <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedulerDriver</span><span class="o">.</span><span class="n">select_next_target</span><span class="p">()</span>

                                    <span class="bp">self</span><span class="o">.</span><span class="n">wtopic_target</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topicTarget</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

                                    <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">putSample_target</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topicTarget</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;run: tx target </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>

                                    <span class="n">waitobservation</span> <span class="o">=</span> <span class="kc">True</span>

                                <span class="n">lastobstime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                                <span class="k">while</span> <span class="n">waitobservation</span><span class="p">:</span>
                                    <span class="n">scode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">getNextSample_observation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topicObservation</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="n">scode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">topicObservation</span><span class="o">.</span><span class="n">targetId</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                                        <span class="n">lastobstime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                                        <span class="n">meascount</span> <span class="o">+=</span> <span class="mi">1</span>
                                        <span class="n">visitcount</span> <span class="o">+=</span> <span class="mi">1</span>
                                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topicTarget</span><span class="o">.</span><span class="n">targetId</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">topicObservation</span><span class="o">.</span><span class="n">targetId</span><span class="p">:</span>
                                            <span class="n">synccount</span> <span class="o">+=</span> <span class="mi">1</span>

                                            <span class="n">obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rtopic_observation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topicObservation</span><span class="p">)</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">EXTENSIVE</span><span class="p">,</span> <span class="s2">&quot;run: rx observation </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">obs</span><span class="p">))</span>
                                            <span class="n">target_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedulerDriver</span><span class="o">.</span><span class="n">register_observation</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
                                            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wtopic_interestedProposal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tInterestedProposal</span><span class="p">,</span>
                                                                               <span class="bp">self</span><span class="o">.</span><span class="n">topicObservation</span><span class="o">.</span><span class="n">targetId</span><span class="p">,</span>
                                                                               <span class="n">target_list</span><span class="p">)</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">putSample_interestedProposal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tInterestedProposal</span><span class="p">)</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">EXTENSIVE</span><span class="p">,</span> <span class="s2">&quot;run: tx interested </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
                                            <span class="n">waitobservation</span> <span class="o">=</span> <span class="kc">False</span>
                                        <span class="k">else</span><span class="p">:</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;run: rx unsync observation Id=</span><span class="si">%i</span><span class="s2"> &quot;</span>
                                                             <span class="s2">&quot;for target Id=</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span>
                                                             <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topicObservation</span><span class="o">.</span><span class="n">targetId</span><span class="p">,</span>
                                                              <span class="bp">self</span><span class="o">.</span><span class="n">topicTarget</span><span class="o">.</span><span class="n">targetId</span><span class="p">))</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">to</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                                        <span class="k">if</span> <span class="p">(</span><span class="n">to</span> <span class="o">-</span> <span class="n">lastobstime</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_loop_timeouts</span><span class="p">):</span>
                                            <span class="n">waitobservation</span> <span class="o">=</span> <span class="kc">False</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;run: observation timeout&quot;</span><span class="p">)</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">TRACE</span><span class="p">,</span> <span class="s2">&quot;run: t=</span><span class="si">%f</span><span class="s2"> lastobstime=</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">lastobstime</span><span class="p">))</span>

                                    <span class="n">newtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                                    <span class="n">deltatime</span> <span class="o">=</span> <span class="n">newtime</span> <span class="o">-</span> <span class="n">meastime</span>
                                    <span class="k">if</span> <span class="n">deltatime</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measinterval</span><span class="p">:</span>
                                        <span class="n">rate</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">meascount</span><span class="p">)</span> <span class="o">/</span> <span class="n">deltatime</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: rxi </span><span class="si">%.0f</span><span class="s2"> visits/sec total=</span><span class="si">%i</span><span class="s2"> visits sync=</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span>
                                                      <span class="p">(</span><span class="n">rate</span><span class="p">,</span> <span class="n">visitcount</span><span class="p">,</span> <span class="n">synccount</span><span class="p">))</span>
                                        <span class="n">meastime</span> <span class="o">=</span> <span class="n">newtime</span>
                                        <span class="n">meascount</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">ts</span> <span class="o">-</span> <span class="n">laststatetime</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_loop_timeouts</span><span class="p">):</span>
                                    <span class="n">waitstate</span> <span class="o">=</span> <span class="kc">False</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;run: state timeout&quot;</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">TRACE</span><span class="p">,</span> <span class="s2">&quot;run: t=</span><span class="si">%f</span><span class="s2"> laststatetime=</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">laststatetime</span><span class="p">))</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;run: rx non progressive time previous=</span><span class="si">%f</span><span class="s2"> new=</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span>
                                       <span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">topicTime</span><span class="o">.</span><span class="n">timestamp</span><span class="p">))</span>
                        <span class="n">waittime</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tc</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">tc</span> <span class="o">-</span> <span class="n">lasttimetime</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_loop_timeouts</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;run: time timeout&quot;</span><span class="p">)</span>
                        <span class="n">waittime</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="n">newtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="n">deltatime</span> <span class="o">=</span> <span class="n">newtime</span> <span class="o">-</span> <span class="n">meastime</span>
                <span class="k">if</span> <span class="n">deltatime</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measinterval</span><span class="p">:</span>
                    <span class="n">rate</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">meascount</span><span class="p">)</span> <span class="o">/</span> <span class="n">deltatime</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;run: rxe </span><span class="si">%.0f</span><span class="s2"> visits/sec total=</span><span class="si">%i</span><span class="s2"> visits sync=</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rate</span><span class="p">,</span> <span class="n">visitcount</span><span class="p">,</span>
                                                                                        <span class="n">synccount</span><span class="p">))</span>
                    <span class="n">meastime</span> <span class="o">=</span> <span class="n">newtime</span>
                    <span class="n">meascount</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;An exception was thrown in the Scheduler!&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">schedulerDriver</span><span class="o">.</span><span class="n">end_survey</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;exit&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sal</span><span class="o">.</span><span class="n">salShutdown</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Main.rtopic_driver_config"><a class="viewcode-back" href="../../../../api/lsst.ts.scheduler.html#lsst.ts.scheduler.main.Main.rtopic_driver_config">[docs]</a>    <span class="k">def</span> <span class="nf">rtopic_driver_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic_driver_config</span><span class="p">):</span>

        <span class="n">confdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;ranking&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;ranking&quot;</span><span class="p">][</span><span class="s2">&quot;coadd_values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_driver_config</span><span class="o">.</span><span class="n">coadd_values</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;ranking&quot;</span><span class="p">][</span><span class="s2">&quot;time_balancing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_driver_config</span><span class="o">.</span><span class="n">time_balancing</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;ranking&quot;</span><span class="p">][</span><span class="s2">&quot;timecost_time_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_driver_config</span><span class="o">.</span><span class="n">timecost_time_max</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;ranking&quot;</span><span class="p">][</span><span class="s2">&quot;timecost_time_ref&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_driver_config</span><span class="o">.</span><span class="n">timecost_time_ref</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;ranking&quot;</span><span class="p">][</span><span class="s2">&quot;timecost_cost_ref&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_driver_config</span><span class="o">.</span><span class="n">timecost_cost_ref</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;ranking&quot;</span><span class="p">][</span><span class="s2">&quot;timecost_weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_driver_config</span><span class="o">.</span><span class="n">timecost_weight</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;ranking&quot;</span><span class="p">][</span><span class="s2">&quot;filtercost_weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_driver_config</span><span class="o">.</span><span class="n">filtercost_weight</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;ranking&quot;</span><span class="p">][</span><span class="s2">&quot;propboost_weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_driver_config</span><span class="o">.</span><span class="n">propboost_weight</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;constraints&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;constraints&quot;</span><span class="p">][</span><span class="s2">&quot;night_boundary&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_driver_config</span><span class="o">.</span><span class="n">night_boundary</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;constraints&quot;</span><span class="p">][</span><span class="s2">&quot;ignore_sky_brightness&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_driver_config</span><span class="o">.</span><span class="n">ignore_sky_brightness</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;constraints&quot;</span><span class="p">][</span><span class="s2">&quot;ignore_airmass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_driver_config</span><span class="o">.</span><span class="n">ignore_airmass</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;constraints&quot;</span><span class="p">][</span><span class="s2">&quot;ignore_clouds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_driver_config</span><span class="o">.</span><span class="n">ignore_clouds</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;constraints&quot;</span><span class="p">][</span><span class="s2">&quot;ignore_seeing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_driver_config</span><span class="o">.</span><span class="n">ignore_seeing</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;darktime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;darktime&quot;</span><span class="p">][</span><span class="s2">&quot;new_moon_phase_threshold&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_driver_config</span><span class="o">.</span><span class="n">new_moon_phase_threshold</span>

        <span class="k">return</span> <span class="n">confdict</span></div>

<div class="viewcode-block" id="Main.rtopic_location_config"><a class="viewcode-back" href="../../../../api/lsst.ts.scheduler.html#lsst.ts.scheduler.main.Main.rtopic_location_config">[docs]</a>    <span class="k">def</span> <span class="nf">rtopic_location_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic_location_config</span><span class="p">):</span>

        <span class="n">confdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;obs_site&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;obs_site&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_location_config</span><span class="o">.</span><span class="n">name</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;obs_site&quot;</span><span class="p">][</span><span class="s2">&quot;latitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_location_config</span><span class="o">.</span><span class="n">latitude</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;obs_site&quot;</span><span class="p">][</span><span class="s2">&quot;longitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_location_config</span><span class="o">.</span><span class="n">longitude</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;obs_site&quot;</span><span class="p">][</span><span class="s2">&quot;height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_location_config</span><span class="o">.</span><span class="n">height</span>

        <span class="k">return</span> <span class="n">confdict</span></div>

<div class="viewcode-block" id="Main.rtopic_telescope_config"><a class="viewcode-back" href="../../../../api/lsst.ts.scheduler.html#lsst.ts.scheduler.main.Main.rtopic_telescope_config">[docs]</a>    <span class="k">def</span> <span class="nf">rtopic_telescope_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic_telescope_config</span><span class="p">):</span>

        <span class="n">confdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;telescope&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;telescope&quot;</span><span class="p">][</span><span class="s2">&quot;altitude_minpos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_telescope_config</span><span class="o">.</span><span class="n">altitude_minpos</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;telescope&quot;</span><span class="p">][</span><span class="s2">&quot;altitude_maxpos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_telescope_config</span><span class="o">.</span><span class="n">altitude_maxpos</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;telescope&quot;</span><span class="p">][</span><span class="s2">&quot;azimuth_minpos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_telescope_config</span><span class="o">.</span><span class="n">azimuth_minpos</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;telescope&quot;</span><span class="p">][</span><span class="s2">&quot;azimuth_maxpos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_telescope_config</span><span class="o">.</span><span class="n">azimuth_maxpos</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;telescope&quot;</span><span class="p">][</span><span class="s2">&quot;altitude_maxspeed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_telescope_config</span><span class="o">.</span><span class="n">altitude_maxspeed</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;telescope&quot;</span><span class="p">][</span><span class="s2">&quot;altitude_accel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_telescope_config</span><span class="o">.</span><span class="n">altitude_accel</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;telescope&quot;</span><span class="p">][</span><span class="s2">&quot;altitude_decel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_telescope_config</span><span class="o">.</span><span class="n">altitude_decel</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;telescope&quot;</span><span class="p">][</span><span class="s2">&quot;azimuth_maxspeed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_telescope_config</span><span class="o">.</span><span class="n">azimuth_maxspeed</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;telescope&quot;</span><span class="p">][</span><span class="s2">&quot;azimuth_accel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_telescope_config</span><span class="o">.</span><span class="n">azimuth_accel</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;telescope&quot;</span><span class="p">][</span><span class="s2">&quot;azimuth_decel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_telescope_config</span><span class="o">.</span><span class="n">azimuth_decel</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;telescope&quot;</span><span class="p">][</span><span class="s2">&quot;altitude_minpos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_telescope_config</span><span class="o">.</span><span class="n">altitude_minpos</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;telescope&quot;</span><span class="p">][</span><span class="s2">&quot;altitude_minpos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_telescope_config</span><span class="o">.</span><span class="n">altitude_minpos</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;telescope&quot;</span><span class="p">][</span><span class="s2">&quot;altitude_minpos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_telescope_config</span><span class="o">.</span><span class="n">altitude_minpos</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;telescope&quot;</span><span class="p">][</span><span class="s2">&quot;settle_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_telescope_config</span><span class="o">.</span><span class="n">settle_time</span>

        <span class="k">return</span> <span class="n">confdict</span></div>

<div class="viewcode-block" id="Main.rtopic_dome_config"><a class="viewcode-back" href="../../../../api/lsst.ts.scheduler.html#lsst.ts.scheduler.main.Main.rtopic_dome_config">[docs]</a>    <span class="k">def</span> <span class="nf">rtopic_dome_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic_dome_config</span><span class="p">):</span>

        <span class="n">confdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;dome&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;dome&quot;</span><span class="p">][</span><span class="s2">&quot;altitude_maxspeed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_dome_config</span><span class="o">.</span><span class="n">altitude_maxspeed</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;dome&quot;</span><span class="p">][</span><span class="s2">&quot;altitude_accel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_dome_config</span><span class="o">.</span><span class="n">altitude_accel</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;dome&quot;</span><span class="p">][</span><span class="s2">&quot;altitude_decel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_dome_config</span><span class="o">.</span><span class="n">altitude_decel</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;dome&quot;</span><span class="p">][</span><span class="s2">&quot;azimuth_maxspeed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_dome_config</span><span class="o">.</span><span class="n">azimuth_maxspeed</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;dome&quot;</span><span class="p">][</span><span class="s2">&quot;azimuth_accel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_dome_config</span><span class="o">.</span><span class="n">azimuth_accel</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;dome&quot;</span><span class="p">][</span><span class="s2">&quot;azimuth_decel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_dome_config</span><span class="o">.</span><span class="n">azimuth_decel</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;dome&quot;</span><span class="p">][</span><span class="s2">&quot;settle_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_dome_config</span><span class="o">.</span><span class="n">settle_time</span>

        <span class="k">return</span> <span class="n">confdict</span></div>

<div class="viewcode-block" id="Main.rtopic_rotator_config"><a class="viewcode-back" href="../../../../api/lsst.ts.scheduler.html#lsst.ts.scheduler.main.Main.rtopic_rotator_config">[docs]</a>    <span class="k">def</span> <span class="nf">rtopic_rotator_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic_rotator_config</span><span class="p">):</span>

        <span class="n">confdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;rotator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;rotator&quot;</span><span class="p">][</span><span class="s2">&quot;minpos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_rotator_config</span><span class="o">.</span><span class="n">minpos</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;rotator&quot;</span><span class="p">][</span><span class="s2">&quot;maxpos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_rotator_config</span><span class="o">.</span><span class="n">maxpos</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;rotator&quot;</span><span class="p">][</span><span class="s2">&quot;maxspeed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_rotator_config</span><span class="o">.</span><span class="n">maxspeed</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;rotator&quot;</span><span class="p">][</span><span class="s2">&quot;accel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_rotator_config</span><span class="o">.</span><span class="n">accel</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;rotator&quot;</span><span class="p">][</span><span class="s2">&quot;decel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_rotator_config</span><span class="o">.</span><span class="n">decel</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;rotator&quot;</span><span class="p">][</span><span class="s2">&quot;filter_change_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_rotator_config</span><span class="o">.</span><span class="n">filter_change_pos</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;rotator&quot;</span><span class="p">][</span><span class="s2">&quot;follow_sky&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_rotator_config</span><span class="o">.</span><span class="n">followsky</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;rotator&quot;</span><span class="p">][</span><span class="s2">&quot;resume_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_rotator_config</span><span class="o">.</span><span class="n">resume_angle</span>

        <span class="k">return</span> <span class="n">confdict</span></div>

<div class="viewcode-block" id="Main.rtopic_optics_config"><a class="viewcode-back" href="../../../../api/lsst.ts.scheduler.html#lsst.ts.scheduler.main.Main.rtopic_optics_config">[docs]</a>    <span class="k">def</span> <span class="nf">rtopic_optics_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic_optics_config</span><span class="p">):</span>

        <span class="n">tel_optics_cl_alt_limit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">tel_optics_cl_alt_limit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topic_optics_config</span><span class="o">.</span><span class="n">tel_optics_cl_alt_limit</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">tel_optics_cl_delay</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">tel_optics_cl_delay</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topic_optics_config</span><span class="o">.</span><span class="n">tel_optics_cl_delay</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

        <span class="n">confdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;optics_loop_corr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;optics_loop_corr&quot;</span><span class="p">][</span><span class="s2">&quot;tel_optics_ol_slope&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_optics_config</span><span class="o">.</span><span class="n">tel_optics_ol_slope</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;optics_loop_corr&quot;</span><span class="p">][</span><span class="s2">&quot;tel_optics_cl_alt_limit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tel_optics_cl_alt_limit</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;optics_loop_corr&quot;</span><span class="p">][</span><span class="s2">&quot;tel_optics_cl_delay&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tel_optics_cl_delay</span>

        <span class="k">return</span> <span class="n">confdict</span></div>

<div class="viewcode-block" id="Main.rtopic_camera_config"><a class="viewcode-back" href="../../../../api/lsst.ts.scheduler.html#lsst.ts.scheduler.main.Main.rtopic_camera_config">[docs]</a>    <span class="k">def</span> <span class="nf">rtopic_camera_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic_camera_config</span><span class="p">):</span>

        <span class="n">confdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;camera&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;camera&quot;</span><span class="p">][</span><span class="s2">&quot;readout_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_camera_config</span><span class="o">.</span><span class="n">readout_time</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;camera&quot;</span><span class="p">][</span><span class="s2">&quot;shutter_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_camera_config</span><span class="o">.</span><span class="n">shutter_time</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;camera&quot;</span><span class="p">][</span><span class="s2">&quot;filter_change_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_camera_config</span><span class="o">.</span><span class="n">filter_change_time</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;camera&quot;</span><span class="p">][</span><span class="s2">&quot;filter_max_changes_burst_num&quot;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">topic_camera_config</span><span class="o">.</span><span class="n">filter_max_changes_burst_num</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;camera&quot;</span><span class="p">][</span><span class="s2">&quot;filter_max_changes_burst_time&quot;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">topic_camera_config</span><span class="o">.</span><span class="n">filter_max_changes_burst_time</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;camera&quot;</span><span class="p">][</span><span class="s2">&quot;filter_max_changes_avg_num&quot;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">topic_camera_config</span><span class="o">.</span><span class="n">filter_max_changes_avg_num</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;camera&quot;</span><span class="p">][</span><span class="s2">&quot;filter_max_changes_avg_time&quot;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">topic_camera_config</span><span class="o">.</span><span class="n">filter_max_changes_avg_time</span>
        <span class="k">if</span> <span class="n">topic_camera_config</span><span class="o">.</span><span class="n">filter_removable</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;camera&quot;</span><span class="p">][</span><span class="s2">&quot;filter_removable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_camera_config</span><span class="o">.</span><span class="n">filter_removable</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;camera&quot;</span><span class="p">][</span><span class="s2">&quot;filter_removable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">topic_camera_config</span><span class="o">.</span><span class="n">filter_mounted</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;camera&quot;</span><span class="p">][</span><span class="s2">&quot;filter_mounted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_camera_config</span><span class="o">.</span><span class="n">filter_mounted</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;camera&quot;</span><span class="p">][</span><span class="s2">&quot;filter_mounted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">topic_camera_config</span><span class="o">.</span><span class="n">filter_unmounted</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;camera&quot;</span><span class="p">][</span><span class="s2">&quot;filter_unmounted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_camera_config</span><span class="o">.</span><span class="n">filter_unmounted</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;camera&quot;</span><span class="p">][</span><span class="s2">&quot;filter_unmounted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="n">confdict</span></div>

<div class="viewcode-block" id="Main.rtopic_slew_config"><a class="viewcode-back" href="../../../../api/lsst.ts.scheduler.html#lsst.ts.scheduler.main.Main.rtopic_slew_config">[docs]</a>    <span class="k">def</span> <span class="nf">rtopic_slew_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic_slew_config</span><span class="p">):</span>

        <span class="n">confdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">prereq_str</span> <span class="o">=</span> <span class="n">topic_slew_config</span><span class="o">.</span><span class="n">prereq_domalt</span>
        <span class="k">if</span> <span class="n">prereq_str</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">][</span><span class="s2">&quot;prereq_domalt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prereq_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">][</span><span class="s2">&quot;prereq_domalt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">prereq_str</span> <span class="o">=</span> <span class="n">topic_slew_config</span><span class="o">.</span><span class="n">prereq_domaz</span>
        <span class="k">if</span> <span class="n">prereq_str</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">][</span><span class="s2">&quot;prereq_domaz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prereq_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">][</span><span class="s2">&quot;prereq_domaz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">prereq_str</span> <span class="o">=</span> <span class="n">topic_slew_config</span><span class="o">.</span><span class="n">prereq_domazsettle</span>
        <span class="k">if</span> <span class="n">prereq_str</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">][</span><span class="s2">&quot;prereq_domazsettle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prereq_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">][</span><span class="s2">&quot;prereq_domazsettle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">prereq_str</span> <span class="o">=</span> <span class="n">topic_slew_config</span><span class="o">.</span><span class="n">prereq_telalt</span>
        <span class="k">if</span> <span class="n">prereq_str</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">][</span><span class="s2">&quot;prereq_telalt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prereq_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">][</span><span class="s2">&quot;prereq_telalt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">prereq_str</span> <span class="o">=</span> <span class="n">topic_slew_config</span><span class="o">.</span><span class="n">prereq_telaz</span>
        <span class="k">if</span> <span class="n">prereq_str</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">][</span><span class="s2">&quot;prereq_telaz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prereq_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">][</span><span class="s2">&quot;prereq_telaz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">prereq_str</span> <span class="o">=</span> <span class="n">topic_slew_config</span><span class="o">.</span><span class="n">prereq_telopticsopenloop</span>
        <span class="k">if</span> <span class="n">prereq_str</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">][</span><span class="s2">&quot;prereq_telopticsopenloop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prereq_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">][</span><span class="s2">&quot;prereq_telopticsopenloop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">prereq_str</span> <span class="o">=</span> <span class="n">topic_slew_config</span><span class="o">.</span><span class="n">prereq_telopticsclosedloop</span>
        <span class="k">if</span> <span class="n">prereq_str</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">][</span><span class="s2">&quot;prereq_telopticsclosedloop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prereq_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">][</span><span class="s2">&quot;prereq_telopticsclosedloop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">prereq_str</span> <span class="o">=</span> <span class="n">topic_slew_config</span><span class="o">.</span><span class="n">prereq_telsettle</span>
        <span class="k">if</span> <span class="n">prereq_str</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">][</span><span class="s2">&quot;prereq_telsettle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prereq_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">][</span><span class="s2">&quot;prereq_telsettle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">prereq_str</span> <span class="o">=</span> <span class="n">topic_slew_config</span><span class="o">.</span><span class="n">prereq_telrot</span>
        <span class="k">if</span> <span class="n">prereq_str</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">][</span><span class="s2">&quot;prereq_telrot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prereq_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">][</span><span class="s2">&quot;prereq_telrot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">prereq_str</span> <span class="o">=</span> <span class="n">topic_slew_config</span><span class="o">.</span><span class="n">prereq_filter</span>
        <span class="k">if</span> <span class="n">prereq_str</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">][</span><span class="s2">&quot;prereq_filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prereq_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">][</span><span class="s2">&quot;prereq_filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">prereq_str</span> <span class="o">=</span> <span class="n">topic_slew_config</span><span class="o">.</span><span class="n">prereq_exposures</span>
        <span class="k">if</span> <span class="n">prereq_str</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">][</span><span class="s2">&quot;prereq_exposures&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prereq_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">][</span><span class="s2">&quot;prereq_exposures&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">prereq_str</span> <span class="o">=</span> <span class="n">topic_slew_config</span><span class="o">.</span><span class="n">prereq_readout</span>
        <span class="k">if</span> <span class="n">prereq_str</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">][</span><span class="s2">&quot;prereq_readout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prereq_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;slew&quot;</span><span class="p">][</span><span class="s2">&quot;prereq_readout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="n">confdict</span></div>

<div class="viewcode-block" id="Main.rtopic_park_config"><a class="viewcode-back" href="../../../../api/lsst.ts.scheduler.html#lsst.ts.scheduler.main.Main.rtopic_park_config">[docs]</a>    <span class="k">def</span> <span class="nf">rtopic_park_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic_park_config</span><span class="p">):</span>

        <span class="n">confdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;park&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;park&quot;</span><span class="p">][</span><span class="s2">&quot;telescope_altitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_park_config</span><span class="o">.</span><span class="n">telescope_altitude</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;park&quot;</span><span class="p">][</span><span class="s2">&quot;telescope_azimuth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_park_config</span><span class="o">.</span><span class="n">telescope_azimuth</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;park&quot;</span><span class="p">][</span><span class="s2">&quot;telescope_rotator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_park_config</span><span class="o">.</span><span class="n">telescope_rotator</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;park&quot;</span><span class="p">][</span><span class="s2">&quot;dome_altitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_park_config</span><span class="o">.</span><span class="n">dome_altitude</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;park&quot;</span><span class="p">][</span><span class="s2">&quot;dome_azimuth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_park_config</span><span class="o">.</span><span class="n">dome_azimuth</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;park&quot;</span><span class="p">][</span><span class="s2">&quot;filter_position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_park_config</span><span class="o">.</span><span class="n">filter_position</span>

        <span class="k">return</span> <span class="n">confdict</span></div>

<div class="viewcode-block" id="Main.rtopic_area_prop_config"><a class="viewcode-back" href="../../../../api/lsst.ts.scheduler.html#lsst.ts.scheduler.main.Main.rtopic_area_prop_config">[docs]</a>    <span class="k">def</span> <span class="nf">rtopic_area_prop_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic_areapropconf</span><span class="p">):</span>

        <span class="n">confdict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;sky_nightly_bounds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;sky_nightly_bounds&quot;</span><span class="p">][</span><span class="s2">&quot;twilight_boundary&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">twilight_boundary</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;sky_nightly_bounds&quot;</span><span class="p">][</span><span class="s2">&quot;delta_lst&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">delta_lst</span>

        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;constraints&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;constraints&quot;</span><span class="p">][</span><span class="s2">&quot;max_airmass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">max_airmass</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;constraints&quot;</span><span class="p">][</span><span class="s2">&quot;max_cloud&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">max_cloud</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;constraints&quot;</span><span class="p">][</span><span class="s2">&quot;min_distance_moon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">min_distance_moon</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;constraints&quot;</span><span class="p">][</span><span class="s2">&quot;exclude_planets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">exclude_planets</span>

        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;sky_region&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">num_region_selections</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">num_region_selections</span>
        <span class="n">region_types</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">region_types</span>
        <span class="k">if</span> <span class="n">region_types</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">region_types_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">region_types_list</span> <span class="o">=</span> <span class="n">region_types</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

        <span class="n">region_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_region_selections</span><span class="p">):</span>
            <span class="n">region_minimum</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">region_minimums</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">region_maximum</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">region_maximums</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">region_bound</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">region_bounds</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

            <span class="n">region</span> <span class="o">=</span> <span class="p">(</span><span class="n">region_types_list</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">region_minimum</span><span class="p">,</span> <span class="n">region_maximum</span><span class="p">,</span> <span class="n">region_bound</span><span class="p">)</span>
            <span class="n">region_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
        <span class="n">region_combiners</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">region_combiners</span>
        <span class="k">if</span> <span class="n">region_combiners</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">region_combiners_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">region_combiners_list</span> <span class="o">=</span> <span class="n">region_combiners</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;sky_region&quot;</span><span class="p">][</span><span class="s2">&quot;cuts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">region_list</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;sky_region&quot;</span><span class="p">][</span><span class="s2">&quot;combiners&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">region_combiners_list</span>

        <span class="n">num_time_ranges</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">num_time_ranges</span>
        <span class="k">if</span> <span class="n">num_time_ranges</span><span class="p">:</span>
            <span class="n">time_range_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">selection_mappings</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">selection_index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_time_ranges</span><span class="p">):</span>
                <span class="n">time_range_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">time_range_starts</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
                                        <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">time_range_ends</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
                <span class="n">num_selection_mappings</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">num_selection_mappings</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">selection_map</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_selection_mappings</span><span class="p">):</span>
                    <span class="n">selection_map</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">selection_mappings</span><span class="p">[</span><span class="n">selection_index</span><span class="p">])</span>
                    <span class="n">selection_index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">selection_mappings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">selection_map</span><span class="p">)</span>

            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;sky_region&quot;</span><span class="p">][</span><span class="s2">&quot;time_ranges&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_range_list</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;sky_region&quot;</span><span class="p">][</span><span class="s2">&quot;selection_mappings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selection_mappings</span>

        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;sky_exclusions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">num_exclusion_selections</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">num_exclusion_selections</span>
        <span class="n">exclusion_types</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">exclusion_types</span>
        <span class="k">if</span> <span class="n">exclusion_types</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">exclusion_types_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exclusion_types_list</span> <span class="o">=</span> <span class="n">exclusion_types</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">exclusion_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_exclusion_selections</span><span class="p">):</span>
            <span class="n">exclusion_minimum</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">exclusion_minimums</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">exclusion_maximum</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">exclusion_maximums</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">exclusion_bound</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">exclusion_bounds</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

            <span class="n">exclusion</span> <span class="o">=</span> <span class="p">(</span><span class="n">exclusion_types_list</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">exclusion_minimum</span><span class="p">,</span>
                         <span class="n">exclusion_maximum</span><span class="p">,</span> <span class="n">exclusion_bound</span><span class="p">)</span>
            <span class="n">exclusion_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">exclusion</span><span class="p">)</span>

        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;sky_exclusions&quot;</span><span class="p">][</span><span class="s2">&quot;cuts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exclusion_list</span>
        <span class="n">dec_window</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">dec_window</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;sky_exclusions&quot;</span><span class="p">][</span><span class="s2">&quot;dec_window&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dec_window</span>

        <span class="n">num_filters</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">num_filters</span>
        <span class="n">filter_names</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">filter_names</span>
        <span class="n">filter_list</span> <span class="o">=</span> <span class="n">filter_names</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">exp_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_filters</span><span class="p">):</span>
            <span class="nb">filter</span> <span class="o">=</span> <span class="n">filter_list</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">filter_section</span> <span class="o">=</span> <span class="s2">&quot;filter_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">filter</span>
            <span class="n">confdict</span><span class="p">[</span><span class="n">filter_section</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">confdict</span><span class="p">[</span><span class="n">filter_section</span><span class="p">][</span><span class="s2">&quot;visits&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">num_visits</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">confdict</span><span class="p">[</span><span class="n">filter_section</span><span class="p">][</span><span class="s2">&quot;min_brig&quot;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">bright_limit</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">confdict</span><span class="p">[</span><span class="n">filter_section</span><span class="p">][</span><span class="s2">&quot;max_brig&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">dark_limit</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">confdict</span><span class="p">[</span><span class="n">filter_section</span><span class="p">][</span><span class="s2">&quot;max_seeing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">max_seeing</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">num_exp</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">num_filter_exposures</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">exp_times_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_exp</span><span class="p">):</span>
                <span class="n">exp_times_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">exposures</span><span class="p">[</span><span class="n">exp_index</span><span class="p">])</span>
                <span class="n">exp_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">confdict</span><span class="p">[</span><span class="n">filter_section</span><span class="p">][</span><span class="s2">&quot;exp_times&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exp_times_list</span>
            <span class="n">confdict</span><span class="p">[</span><span class="n">filter_section</span><span class="p">][</span><span class="s2">&quot;num_grouped_visits&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">num_grouped_visits</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">confdict</span><span class="p">[</span><span class="n">filter_section</span><span class="p">][</span><span class="s2">&quot;max_grouped_visits&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">max_grouped_visits</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;scheduling&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">max_num_targets</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">max_num_targets</span>
        <span class="n">accept_serendipity</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">accept_serendipity</span>
        <span class="n">accept_consecutive_visits</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">accept_consecutive_visits</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;scheduling&quot;</span><span class="p">][</span><span class="s2">&quot;max_num_targets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_num_targets</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;scheduling&quot;</span><span class="p">][</span><span class="s2">&quot;accept_serendipity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">accept_serendipity</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;scheduling&quot;</span><span class="p">][</span><span class="s2">&quot;accept_consecutive_visits&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">accept_consecutive_visits</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;scheduling&quot;</span><span class="p">][</span><span class="s2">&quot;airmass_bonus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">airmass_bonus</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;scheduling&quot;</span><span class="p">][</span><span class="s2">&quot;hour_angle_bonus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">hour_angle_bonus</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;scheduling&quot;</span><span class="p">][</span><span class="s2">&quot;hour_angle_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">hour_angle_max</span>

        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;scheduling&quot;</span><span class="p">][</span><span class="s2">&quot;restrict_grouped_visits&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">restrict_grouped_visits</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;scheduling&quot;</span><span class="p">][</span><span class="s2">&quot;time_interval&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">time_interval</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;scheduling&quot;</span><span class="p">][</span><span class="s2">&quot;time_window_start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">time_window_start</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;scheduling&quot;</span><span class="p">][</span><span class="s2">&quot;time_window_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">time_window_max</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;scheduling&quot;</span><span class="p">][</span><span class="s2">&quot;time_window_end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">time_window_end</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;scheduling&quot;</span><span class="p">][</span><span class="s2">&quot;time_weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">time_weight</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;scheduling&quot;</span><span class="p">][</span><span class="s2">&quot;field_revisit_limit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_areapropconf</span><span class="o">.</span><span class="n">field_revisit_limit</span>

        <span class="k">return</span> <span class="n">confdict</span></div>

<div class="viewcode-block" id="Main.rtopic_seq_prop_config"><a class="viewcode-back" href="../../../../api/lsst.ts.scheduler.html#lsst.ts.scheduler.main.Main.rtopic_seq_prop_config">[docs]</a>    <span class="k">def</span> <span class="nf">rtopic_seq_prop_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic_seqpropconf</span><span class="p">):</span>

        <span class="n">confdict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;sky_nightly_bounds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;sky_nightly_bounds&quot;</span><span class="p">][</span><span class="s2">&quot;twilight_boundary&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">twilight_boundary</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;sky_nightly_bounds&quot;</span><span class="p">][</span><span class="s2">&quot;delta_lst&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">delta_lst</span>

        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;constraints&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;constraints&quot;</span><span class="p">][</span><span class="s2">&quot;max_airmass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">max_airmass</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;constraints&quot;</span><span class="p">][</span><span class="s2">&quot;max_cloud&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">max_cloud</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;constraints&quot;</span><span class="p">][</span><span class="s2">&quot;min_distance_moon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">min_distance_moon</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;constraints&quot;</span><span class="p">][</span><span class="s2">&quot;exclude_planets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">exclude_planets</span>

        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;sky_region&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">num_user_regions</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">num_user_regions</span>
        <span class="n">region_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_user_regions</span><span class="p">):</span>
            <span class="n">region_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">user_region_ids</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;sky_region&quot;</span><span class="p">][</span><span class="s2">&quot;user_regions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">region_list</span>

        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;sky_exclusions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;sky_exclusions&quot;</span><span class="p">][</span><span class="s2">&quot;dec_window&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">dec_window</span>

        <span class="n">num_sub_sequences</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">num_sub_sequences</span>
        <span class="k">if</span> <span class="n">num_sub_sequences</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;subsequences&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">sub_sequence_names</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">sub_sequence_names</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;subsequences&quot;</span><span class="p">][</span><span class="s2">&quot;names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub_sequence_names</span>
            <span class="n">sub_sequence_filters</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">sub_sequence_filters</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="n">sub_sequence_visits_per_filter</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">num_sub_sequence_filter_visits</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">sname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sub_sequence_names</span><span class="p">):</span>
                <span class="n">sub_seq_section</span> <span class="o">=</span> <span class="s2">&quot;subseq_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sname</span><span class="p">)</span>
                <span class="n">confdict</span><span class="p">[</span><span class="n">sub_seq_section</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">num_sub_sequence_filters</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">num_sub_sequence_filters</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">confdict</span><span class="p">[</span><span class="n">sub_seq_section</span><span class="p">][</span><span class="s2">&quot;filters&quot;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">sub_sequence_filters</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span> <span class="o">+</span> <span class="n">num_sub_sequence_filters</span><span class="p">]</span>
                <span class="n">confdict</span><span class="p">[</span><span class="n">sub_seq_section</span><span class="p">][</span><span class="s2">&quot;visits_per_filter&quot;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">sub_sequence_visits_per_filter</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span> <span class="o">+</span> <span class="n">num_sub_sequence_filters</span><span class="p">]</span>
                <span class="n">index</span> <span class="o">+=</span> <span class="n">num_sub_sequence_filters</span>
                <span class="n">confdict</span><span class="p">[</span><span class="n">sub_seq_section</span><span class="p">][</span><span class="s2">&quot;num_events&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">num_sub_sequence_events</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">confdict</span><span class="p">[</span><span class="n">sub_seq_section</span><span class="p">][</span><span class="s2">&quot;num_max_missed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">num_sub_sequence_max_missed</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">confdict</span><span class="p">[</span><span class="n">sub_seq_section</span><span class="p">][</span><span class="s2">&quot;time_interval&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">sub_sequence_time_intervals</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">confdict</span><span class="p">[</span><span class="n">sub_seq_section</span><span class="p">][</span><span class="s2">&quot;time_window_start&quot;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">sub_sequence_time_window_starts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">confdict</span><span class="p">[</span><span class="n">sub_seq_section</span><span class="p">][</span><span class="s2">&quot;time_window_max&quot;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">sub_sequence_time_window_maximums</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">confdict</span><span class="p">[</span><span class="n">sub_seq_section</span><span class="p">][</span><span class="s2">&quot;time_window_end&quot;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">sub_sequence_time_window_ends</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">confdict</span><span class="p">[</span><span class="n">sub_seq_section</span><span class="p">][</span><span class="s2">&quot;time_weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">sub_sequence_time_weights</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="n">num_master_sub_sequences</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">num_master_sub_sequences</span>
        <span class="k">if</span> <span class="n">num_master_sub_sequences</span><span class="p">:</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;master_subsequences&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">master_sub_sequence_names</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">master_sub_sequence_names</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;master_subsequences&quot;</span><span class="p">][</span><span class="s2">&quot;names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">master_sub_sequence_names</span>
            <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;master_subsequences&quot;</span><span class="p">][</span><span class="s2">&quot;num_nested&quot;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">num_nested_sub_sequences</span><span class="p">[:</span><span class="n">num_master_sub_sequences</span><span class="p">]</span>
            <span class="n">nested_sub_sequence_names</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">nested_sub_sequence_names</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="n">nested_sub_sequence_filters</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">nested_sub_sequence_filters</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">findex</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">mname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">master_sub_sequence_names</span><span class="p">):</span>
                <span class="n">msub_seq_section</span> <span class="o">=</span> <span class="s2">&quot;msubseq_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mname</span><span class="p">)</span>
                <span class="n">confdict</span><span class="p">[</span><span class="n">msub_seq_section</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">num_nested_sub_sequences</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">num_nested_sub_sequences</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">confdict</span><span class="p">[</span><span class="n">msub_seq_section</span><span class="p">][</span><span class="s2">&quot;nested_names&quot;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">nested_sub_sequence_names</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span> <span class="o">+</span> <span class="n">num_nested_sub_sequences</span><span class="p">]</span>
                <span class="n">confdict</span><span class="p">[</span><span class="n">msub_seq_section</span><span class="p">][</span><span class="s2">&quot;num_events&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">num_master_sub_sequence_events</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">confdict</span><span class="p">[</span><span class="n">msub_seq_section</span><span class="p">][</span><span class="s2">&quot;num_max_missed&quot;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">num_master_sub_sequence_max_missed</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">confdict</span><span class="p">[</span><span class="n">msub_seq_section</span><span class="p">][</span><span class="s2">&quot;time_interval&quot;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">master_sub_sequence_time_intervals</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">confdict</span><span class="p">[</span><span class="n">msub_seq_section</span><span class="p">][</span><span class="s2">&quot;time_window_start&quot;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">master_sub_sequence_time_window_starts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">confdict</span><span class="p">[</span><span class="n">msub_seq_section</span><span class="p">][</span><span class="s2">&quot;time_window_max&quot;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">master_sub_sequence_time_window_maximums</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">confdict</span><span class="p">[</span><span class="n">msub_seq_section</span><span class="p">][</span><span class="s2">&quot;time_window_end&quot;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">master_sub_sequence_time_window_ends</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">confdict</span><span class="p">[</span><span class="n">msub_seq_section</span><span class="p">][</span><span class="s2">&quot;time_weight&quot;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">master_sub_sequence_time_weights</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">nname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">confdict</span><span class="p">[</span><span class="n">msub_seq_section</span><span class="p">][</span><span class="s2">&quot;nested_names&quot;</span><span class="p">]):</span>
                    <span class="n">nindex</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="n">l</span>
                    <span class="n">nsub_seq_section</span> <span class="o">=</span> <span class="s2">&quot;nsubseq_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nname</span><span class="p">)</span>
                    <span class="n">confdict</span><span class="p">[</span><span class="n">nsub_seq_section</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">num_nested_sub_sequence_filters</span> <span class="o">=</span> \
                        <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">num_nested_sub_sequence_filters</span><span class="p">[</span><span class="n">nindex</span><span class="p">]</span>
                    <span class="n">last_index</span> <span class="o">=</span> <span class="n">findex</span> <span class="o">+</span> <span class="n">num_nested_sub_sequence_filters</span>
                    <span class="n">confdict</span><span class="p">[</span><span class="n">nsub_seq_section</span><span class="p">][</span><span class="s2">&quot;filters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nested_sub_sequence_filters</span><span class="p">[</span><span class="n">findex</span><span class="p">:</span><span class="n">last_index</span><span class="p">]</span>
                    <span class="n">confdict</span><span class="p">[</span><span class="n">nsub_seq_section</span><span class="p">][</span><span class="s2">&quot;visits_per_filter&quot;</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">num_nested_sub_sequence_filter_visits</span><span class="p">[</span><span class="n">findex</span><span class="p">:</span><span class="n">last_index</span><span class="p">]</span>
                    <span class="n">findex</span> <span class="o">+=</span> <span class="n">num_nested_sub_sequence_filters</span>
                    <span class="n">confdict</span><span class="p">[</span><span class="n">nsub_seq_section</span><span class="p">][</span><span class="s2">&quot;num_events&quot;</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">num_nested_sub_sequence_events</span><span class="p">[</span><span class="n">nindex</span><span class="p">]</span>
                    <span class="n">confdict</span><span class="p">[</span><span class="n">nsub_seq_section</span><span class="p">][</span><span class="s2">&quot;num_max_missed&quot;</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">num_nested_sub_sequence_max_missed</span><span class="p">[</span><span class="n">nindex</span><span class="p">]</span>
                    <span class="n">confdict</span><span class="p">[</span><span class="n">nsub_seq_section</span><span class="p">][</span><span class="s2">&quot;time_interval&quot;</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">nested_sub_sequence_time_intervals</span><span class="p">[</span><span class="n">nindex</span><span class="p">]</span>
                    <span class="n">confdict</span><span class="p">[</span><span class="n">nsub_seq_section</span><span class="p">][</span><span class="s2">&quot;time_window_start&quot;</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">nested_sub_sequence_time_window_starts</span><span class="p">[</span><span class="n">nindex</span><span class="p">]</span>
                    <span class="n">confdict</span><span class="p">[</span><span class="n">nsub_seq_section</span><span class="p">][</span><span class="s2">&quot;time_window_max&quot;</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">nested_sub_sequence_time_window_maximums</span><span class="p">[</span><span class="n">nindex</span><span class="p">]</span>
                    <span class="n">confdict</span><span class="p">[</span><span class="n">nsub_seq_section</span><span class="p">][</span><span class="s2">&quot;time_window_end&quot;</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">nested_sub_sequence_time_window_ends</span><span class="p">[</span><span class="n">nindex</span><span class="p">]</span>
                    <span class="n">confdict</span><span class="p">[</span><span class="n">nsub_seq_section</span><span class="p">][</span><span class="s2">&quot;time_weight&quot;</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">nested_sub_sequence_time_weights</span><span class="p">[</span><span class="n">nindex</span><span class="p">]</span>

                <span class="n">index</span> <span class="o">+=</span> <span class="n">num_nested_sub_sequences</span>

        <span class="n">num_filters</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">num_filters</span>
        <span class="n">filter_names</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">filter_names</span>
        <span class="n">filter_list</span> <span class="o">=</span> <span class="n">filter_names</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">exp_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_filters</span><span class="p">):</span>
            <span class="n">filter_section</span> <span class="o">=</span> <span class="s2">&quot;filter_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">filter_list</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">confdict</span><span class="p">[</span><span class="n">filter_section</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">confdict</span><span class="p">[</span><span class="n">filter_section</span><span class="p">][</span><span class="s2">&quot;min_brig&quot;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">bright_limit</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">confdict</span><span class="p">[</span><span class="n">filter_section</span><span class="p">][</span><span class="s2">&quot;max_brig&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">dark_limit</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">confdict</span><span class="p">[</span><span class="n">filter_section</span><span class="p">][</span><span class="s2">&quot;max_seeing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">max_seeing</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">num_exp</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">num_filter_exposures</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">exp_times_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_exp</span><span class="p">):</span>
                <span class="n">exp_times_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">exposures</span><span class="p">[</span><span class="n">exp_index</span><span class="p">])</span>
                <span class="n">exp_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">confdict</span><span class="p">[</span><span class="n">filter_section</span><span class="p">][</span><span class="s2">&quot;exp_times&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exp_times_list</span>

        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;scheduling&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">max_num_targets</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">max_num_targets</span>
        <span class="n">accept_serendipity</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">accept_serendipity</span>
        <span class="n">accept_consecutive_visits</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">accept_consecutive_visits</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;scheduling&quot;</span><span class="p">][</span><span class="s2">&quot;max_num_targets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_num_targets</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;scheduling&quot;</span><span class="p">][</span><span class="s2">&quot;accept_serendipity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">accept_serendipity</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;scheduling&quot;</span><span class="p">][</span><span class="s2">&quot;accept_consecutive_visits&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">accept_consecutive_visits</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;scheduling&quot;</span><span class="p">][</span><span class="s2">&quot;restart_lost_sequences&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">restart_lost_sequences</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;scheduling&quot;</span><span class="p">][</span><span class="s2">&quot;restart_complete_sequences&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">restart_complete_sequences</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;scheduling&quot;</span><span class="p">][</span><span class="s2">&quot;max_visits_goal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">max_visits_goal</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;scheduling&quot;</span><span class="p">][</span><span class="s2">&quot;airmass_bonus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">airmass_bonus</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;scheduling&quot;</span><span class="p">][</span><span class="s2">&quot;hour_angle_bonus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">hour_angle_bonus</span>
        <span class="n">confdict</span><span class="p">[</span><span class="s2">&quot;scheduling&quot;</span><span class="p">][</span><span class="s2">&quot;hour_angle_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic_seqpropconf</span><span class="o">.</span><span class="n">hour_angle_max</span>

        <span class="k">return</span> <span class="n">confdict</span></div>

<div class="viewcode-block" id="Main.wtopic_target"><a class="viewcode-back" href="../../../../api/lsst.ts.scheduler.html#lsst.ts.scheduler.main.Main.wtopic_target">[docs]</a>    <span class="k">def</span> <span class="nf">wtopic_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topicTarget</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>

        <span class="n">topicTarget</span><span class="o">.</span><span class="n">targetId</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">targetid</span>
        <span class="n">topicTarget</span><span class="o">.</span><span class="n">groupId</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">groupid</span>
        <span class="n">topicTarget</span><span class="o">.</span><span class="n">fieldId</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">fieldid</span>
        <span class="n">topicTarget</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">filter</span>
        <span class="n">topicTarget</span><span class="o">.</span><span class="n">request_time</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">time</span>
        <span class="n">topicTarget</span><span class="o">.</span><span class="n">ra</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">ra</span>
        <span class="n">topicTarget</span><span class="o">.</span><span class="n">dec</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">dec</span>
        <span class="n">topicTarget</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">ang</span>
        <span class="n">topicTarget</span><span class="o">.</span><span class="n">num_exposures</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">num_exp</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">exptime</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">exp_times</span><span class="p">):</span>
            <span class="n">topicTarget</span><span class="o">.</span><span class="n">exposure_times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">exptime</span><span class="p">)</span>
        <span class="n">topicTarget</span><span class="o">.</span><span class="n">airmass</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">airmass</span>
        <span class="n">topicTarget</span><span class="o">.</span><span class="n">sky_brightness</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">sky_brightness</span>
        <span class="n">topicTarget</span><span class="o">.</span><span class="n">cloud</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">cloud</span>
        <span class="n">topicTarget</span><span class="o">.</span><span class="n">seeing</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">seeing</span>
        <span class="n">topicTarget</span><span class="o">.</span><span class="n">slew_time</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">slewtime</span>
        <span class="n">topicTarget</span><span class="o">.</span><span class="n">cost</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">cost</span>
        <span class="n">topicTarget</span><span class="o">.</span><span class="n">rank</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">rank</span>
        <span class="n">topicTarget</span><span class="o">.</span><span class="n">num_proposals</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">num_props</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">prop_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">propid_list</span><span class="p">):</span>
            <span class="n">topicTarget</span><span class="o">.</span><span class="n">proposal_Ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop_id</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">prop_value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">value_list</span><span class="p">):</span>
            <span class="n">topicTarget</span><span class="o">.</span><span class="n">proposal_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop_value</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">prop_need</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">need_list</span><span class="p">):</span>
            <span class="n">topicTarget</span><span class="o">.</span><span class="n">proposal_needs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop_need</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">prop_bonus</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">bonus_list</span><span class="p">):</span>
            <span class="n">topicTarget</span><span class="o">.</span><span class="n">proposal_bonuses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop_bonus</span>

        <span class="n">prop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedulerDriver</span><span class="o">.</span><span class="n">science_proposal_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">moon_sun</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">sky</span><span class="o">.</span><span class="n">get_moon_sun_info</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">target</span><span class="o">.</span><span class="n">ra_rad</span><span class="p">]),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">target</span><span class="o">.</span><span class="n">dec_rad</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">moon_sun</span><span class="p">[</span><span class="s2">&quot;moonRA&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topicTarget</span><span class="o">.</span><span class="n">moon_ra</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">moon_sun</span><span class="p">[</span><span class="s2">&quot;moonRA&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topicTarget</span><span class="o">.</span><span class="n">moon_dec</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">moon_sun</span><span class="p">[</span><span class="s2">&quot;moonDec&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topicTarget</span><span class="o">.</span><span class="n">moon_alt</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">moon_sun</span><span class="p">[</span><span class="s2">&quot;moonAlt&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topicTarget</span><span class="o">.</span><span class="n">moon_az</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">moon_sun</span><span class="p">[</span><span class="s2">&quot;moonAz&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topicTarget</span><span class="o">.</span><span class="n">moon_phase</span> <span class="o">=</span> <span class="n">moon_sun</span><span class="p">[</span><span class="s2">&quot;moonPhase&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topicTarget</span><span class="o">.</span><span class="n">moon_distance</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">moon_sun</span><span class="p">[</span><span class="s2">&quot;moonDist&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topicTarget</span><span class="o">.</span><span class="n">sun_alt</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">moon_sun</span><span class="p">[</span><span class="s2">&quot;sunAlt&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topicTarget</span><span class="o">.</span><span class="n">sun_az</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">moon_sun</span><span class="p">[</span><span class="s2">&quot;sunAz&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topicTarget</span><span class="o">.</span><span class="n">sun_ra</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">moon_sun</span><span class="p">[</span><span class="s2">&quot;sunRA&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topicTarget</span><span class="o">.</span><span class="n">sun_dec</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">moon_sun</span><span class="p">[</span><span class="s2">&quot;sunDec&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topicTarget</span><span class="o">.</span><span class="n">solar_elong</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">moon_sun</span><span class="p">[</span><span class="s2">&quot;solarElong&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="Main.rtopic_observation"><a class="viewcode-back" href="../../../../api/lsst.ts.scheduler.html#lsst.ts.scheduler.main.Main.rtopic_observation">[docs]</a>    <span class="k">def</span> <span class="nf">rtopic_observation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic_observation</span><span class="p">):</span>

        <span class="n">observation</span> <span class="o">=</span> <span class="n">Target</span><span class="p">()</span>
        <span class="n">observation</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">topic_observation</span><span class="o">.</span><span class="n">observation_start_time</span>
        <span class="n">observation</span><span class="o">.</span><span class="n">targetid</span> <span class="o">=</span> <span class="n">topic_observation</span><span class="o">.</span><span class="n">targetId</span>
        <span class="n">observation</span><span class="o">.</span><span class="n">fieldid</span> <span class="o">=</span> <span class="n">topic_observation</span><span class="o">.</span><span class="n">fieldId</span>
        <span class="n">observation</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">topic_observation</span><span class="o">.</span><span class="n">filter</span>
        <span class="n">observation</span><span class="o">.</span><span class="n">num_props</span> <span class="o">=</span> <span class="n">topic_observation</span><span class="o">.</span><span class="n">num_proposals</span>
        <span class="n">observation</span><span class="o">.</span><span class="n">propid_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">observation</span><span class="o">.</span><span class="n">num_props</span><span class="p">):</span>
            <span class="n">observation</span><span class="o">.</span><span class="n">propid_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topic_observation</span><span class="o">.</span><span class="n">proposal_Ids</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">observation</span><span class="o">.</span><span class="n">ra_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">topic_observation</span><span class="o">.</span><span class="n">ra</span><span class="p">)</span>
        <span class="n">observation</span><span class="o">.</span><span class="n">dec_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">topic_observation</span><span class="o">.</span><span class="n">dec</span><span class="p">)</span>
        <span class="n">observation</span><span class="o">.</span><span class="n">ang_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">topic_observation</span><span class="o">.</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">observation</span><span class="o">.</span><span class="n">num_exp</span> <span class="o">=</span> <span class="n">topic_observation</span><span class="o">.</span><span class="n">num_exposures</span>
        <span class="n">observation</span><span class="o">.</span><span class="n">exp_times</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">topic_observation</span><span class="o">.</span><span class="n">num_exposures</span><span class="p">):</span>
            <span class="n">observation</span><span class="o">.</span><span class="n">exp_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topic_observation</span><span class="o">.</span><span class="n">exposure_times</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">observation</span></div>

<div class="viewcode-block" id="Main.rtopic_observatory_state"><a class="viewcode-back" href="../../../../api/lsst.ts.scheduler.html#lsst.ts.scheduler.main.Main.rtopic_observatory_state">[docs]</a>    <span class="k">def</span> <span class="nf">rtopic_observatory_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic_state</span><span class="p">):</span>

        <span class="n">state</span> <span class="o">=</span> <span class="n">ObservatoryState</span><span class="p">()</span>

        <span class="n">state</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">topic_state</span><span class="o">.</span><span class="n">timestamp</span>
        <span class="n">state</span><span class="o">.</span><span class="n">ra_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">topic_state</span><span class="o">.</span><span class="n">pointing_ra</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">dec_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">topic_state</span><span class="o">.</span><span class="n">pointing_dec</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">ang_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">topic_state</span><span class="o">.</span><span class="n">pointing_angle</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">topic_state</span><span class="o">.</span><span class="n">filter_position</span>
        <span class="n">state</span><span class="o">.</span><span class="n">tracking</span> <span class="o">=</span> <span class="n">topic_state</span><span class="o">.</span><span class="n">tracking</span>
        <span class="n">state</span><span class="o">.</span><span class="n">alt_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">topic_state</span><span class="o">.</span><span class="n">pointing_altitude</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">az_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">topic_state</span><span class="o">.</span><span class="n">pointing_azimuth</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">pa_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">topic_state</span><span class="o">.</span><span class="n">pointing_pa</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">rot_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">topic_state</span><span class="o">.</span><span class="n">pointing_rot</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">telalt_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">topic_state</span><span class="o">.</span><span class="n">telescope_altitude</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">telaz_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">topic_state</span><span class="o">.</span><span class="n">telescope_azimuth</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">telrot_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">topic_state</span><span class="o">.</span><span class="n">telescope_rotator</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">domalt_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">topic_state</span><span class="o">.</span><span class="n">dome_altitude</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">domaz_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">topic_state</span><span class="o">.</span><span class="n">dome_azimuth</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">mountedfilters</span> <span class="o">=</span> <span class="n">topic_state</span><span class="o">.</span><span class="n">filter_mounted</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">unmountedfilters</span> <span class="o">=</span> <span class="n">topic_state</span><span class="o">.</span><span class="n">filter_unmounted</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">state</span></div>

<div class="viewcode-block" id="Main.wtopic_interestedProposal"><a class="viewcode-back" href="../../../../api/lsst.ts.scheduler.html#lsst.ts.scheduler.main.Main.wtopic_interestedProposal">[docs]</a>    <span class="k">def</span> <span class="nf">wtopic_interestedProposal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">,</span> <span class="n">targetId</span><span class="p">,</span> <span class="n">target_list</span><span class="p">):</span>

        <span class="n">topic</span><span class="o">.</span><span class="n">observationId</span> <span class="o">=</span> <span class="n">targetId</span>
        <span class="n">topic</span><span class="o">.</span><span class="n">num_proposals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_list</span><span class="p">)</span>
        <span class="n">propid_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">need_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bonus_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">value_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">propboost_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">topic</span><span class="o">.</span><span class="n">num_proposals</span><span class="p">):</span>
            <span class="n">topic</span><span class="o">.</span><span class="n">proposal_Ids</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_list</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">propid</span>
            <span class="n">topic</span><span class="o">.</span><span class="n">proposal_needs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_list</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">need</span>
            <span class="n">topic</span><span class="o">.</span><span class="n">proposal_bonuses</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_list</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">bonus</span>
            <span class="n">topic</span><span class="o">.</span><span class="n">proposal_values</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_list</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
            <span class="n">topic</span><span class="o">.</span><span class="n">proposal_boosts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_list</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">propboost</span>
            <span class="n">propid_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target_list</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">propid</span><span class="p">)</span>
            <span class="n">need_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target_list</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">need</span><span class="p">)</span>
            <span class="n">bonus_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target_list</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">bonus</span><span class="p">)</span>
            <span class="n">value_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target_list</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">propboost_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target_list</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">propboost</span><span class="p">)</span>
        <span class="n">logstr</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;obsId=</span><span class="si">%i</span><span class="s2"> numprops=</span><span class="si">%i</span><span class="s2"> propid=</span><span class="si">%s</span><span class="s2"> need=</span><span class="si">%s</span><span class="s2"> bonus=</span><span class="si">%s</span><span class="s2"> value=</span><span class="si">%s</span><span class="s2"> propboost=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                  <span class="p">(</span><span class="n">targetId</span><span class="p">,</span> <span class="n">topic</span><span class="o">.</span><span class="n">num_proposals</span><span class="p">,</span>
                   <span class="n">propid_list</span><span class="p">,</span> <span class="n">need_list</span><span class="p">,</span> <span class="n">bonus_list</span><span class="p">,</span> <span class="n">value_list</span><span class="p">,</span> <span class="n">propboost_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">logstr</span></div></div>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Francisco Delgado.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'unknown',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>